---
title: "Eug-Exploratorry analysis"
author: "Eug√©nie Mathieu"
date: "19/04/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r Employee Demographics}
library(kableExtra)
library(tidyverse)
# Employee Demographics
Employee_demographics %>%
  group_by(`Job Class Description`) %>%
  count(`Job Class Description`) %>% 
  arrange(desc(n)) %>%
  kable(caption= "Profession of the police officers by frequency", digits=2) %>%
  kable_styling(bootstrap_options = "striped")


```

We would like to know the proportion of the ethnicities among police officers. We have 128 white people (73.6%), three times less of black persons (24.1%) and 3 hispanic person (2.1%).
```{r Employee Demographics}
Employee_demographics %>%
  group_by(Race) %>%
  count(Race) %>% 
  arrange(desc(n)) %>%
  kable(caption= "Proportion of the race in the CHPD", digits=2) %>%
  kable_styling(bootstrap_options = "striped")

```
We start to analyse the dataset of the police officers. This data base records sociodemographics information on the units of the CHPD, including their matriculation number, Job Class Description, Status, Age, Service Years, Gender and Race. We decided to focus on the job class what are in the field or in the hierarchy of those job classes, with regards to the aim of our project. We filtered thus Job Classes Despcription to obtain a subset including: "POLICE OFFICER I", "POLICE OFFICER II",  "POLICE OFFICER III","POLICE OFFICER IV", "POLICE SERGEANT", "POLICE CAPTAIN", "POLICE CHEF", "POLICE LIEUTENANT", "POLICE CHEF-ASSISTANT".

According to some studies run in the field, a chronic stress caused by police work is an explaination of the use of extralegal force (Griffin & Bernard, 2003). In order to set this assumption, we run two investigations: Figure 1 depicts the modes of the service lengths among genders. We observe that the service length is slightly longer for men than for women. The median ongoing career length for men is 15 years, whereas the women's is approximatively 6 years shorter (-40%). Even if newcomers lower the ongoing service length, such as the outlier in men's category, we observe that men are thus exposed on a longer period to a chronic stress, which is inherent to the job of police officer (Purba & Demou, 2019). 


Griffin, S., & Bernard, T. (2003). Angry Aggression Among Police Officers. Police Quarterly, 6(1), 3-21.
Purba, A., & Demou, E. (2019). The relationship between organisational stressors and mental wellbeing within police officers: a systematic review. BMC Public Health, 19(1).
Thomas, M., Kaufmann, C., Palmer, B., Depp, C., Martin, A., & Glorioso, D. et al. (2016). Paradoxical Trend for Improvement in Mental Health With Aging. The Journal Of Clinical Psychiatry, 77(08), e1019-e1025.
```{r, warning=FALSE, message=FALSE, echo = FALSE, fig-1, fig.cap="Figure 1", out.width="80%", fig.asp=.75,fig.align='center'}

library(dplyr)
meanM<- Employee_demographics%>%
   filter( `Job Class Description` == c("POLICE OFFICER I", "POLICE OFFICER II",  "POLICE OFFICER III","POLICE OFFICER IV", "POLICE SERGEANT", "POLICE CAPTAIN", "POLICE CHEF", "POLICE LIEUTENANT", "POLICE CHEF-ASSISTANT")) %>%
  group_by(Gender) %>%
  summarize(MEANSERVICE = mean(`Service Years`))

Employee_demographics %>%
   filter( `Job Class Description` == c("POLICE OFFICER I", "POLICE OFFICER II",  "POLICE OFFICER III","POLICE OFFICER IV", "POLICE SERGEANT", "POLICE CAPTAIN", "POLICE CHEF", "POLICE LIEUTENANT", "POLICE CHEF-ASSISTANT")) %>%
  group_by(Gender) %>%
  ggplot(aes(Gender,`Service Years`, color= Gender)) +
  geom_boxplot() +
labs(
    title = "Women's service is shorter than the men: men's career are almost quite the double",
    subtitle = "Glimpse of the service length in the Chapel Hill Police District among gender",
    x = "Police officers' gender",
    y = "Service length",
    caption = "data from Employee_demographics.csv",
    col = "Gender")
```

In order to contextualize this information, we had to know when those police officers started their career. We computed easily the age of enrollment, which  is the result of their age minus their service length. The age at which the officers began their career is an important important information, because the  young people are more mentally vulnerable than older ones (Thomas et al., 2016). Starting one's career at a young age and being exposed to a chronic stress and traumatic events have more impact on the subject due to one's age. 

Among filtered job categories, the starting age is under 30 years old in average. All officiers were thus early exposed to chronic stress, and more longer if they gained grades. The hierarchy cumulate more years of experience, between 16 years  old for the sergeant to 19 for the captain. It is intuitive because of the system of reward and the legitimization to obtain this position: the contrary would have been surprising.The hierarchy is not necessarily playing a direct role in the field. Yet, they give orders and guidelines to the police officers, installing a certain culture and mindset to the troops. 
Police officers' starting age takes part in the same interval than for their superior : between 25 and 30 years old. We have two police officers above this age, what could be explain by either a late career or a change in district. Howver, it seems that to reach the fourth level in police officer scale, the experience is a necessary element. Those policemens do not have less than 13 years old of experience, which is a large amount of time spent, by assumption, in streets and on missions.

For now, we have to ascertain if only those job classes follow the trend of young enrollment or if it is a general tendancy respected by all the human ressources of the CHPD.

```{r, warning=FALSE, message=FALSE, echo = FALSE, fig-2, fig.cap="Figure 2", out.width="80%", fig.asp=.75,fig.align='center'}

Employee_demographics %>%
  filter( `Job Class Description` == c("POLICE OFFICER I", "POLICE OFFICER II",  "POLICE OFFICER III","POLICE OFFICER IV", "POLICE SERGEANT", "POLICE CAPTAIN", "POLICE CHEF", "POLICE LIEUTENANT", "POLICE CHEF-ASSISTANT")) %>%
  mutate(AGEBEGINNING = Age - `Service Years`) %>%
  ggplot(aes( x = `Job Class Description`, 
              y = AGEBEGINNING,
              color = `Job Class Description`, 
              pch = `Job Class Description`,
              size = `Service Years`)) + 
  geom_text(
    aes(label= `Service Years`, 
        hjust=1,
        vjust=1)) +
  geom_point() +
labs(
    title = "Beyond the early age of enrollment among classes, we note that Police officer's \ngrade is based on service length",
    subtitle = "Age of enrollment and service length per job class in CHPD",
    x = "Job Class",
    y = "Age of enrollment",
    caption = "data from Employee_demographics.csv")
```

The distribution of the age of enrollement is less straightforward. Some employees start their career in their eraly 40's, a larger fraction after their 30's and 6 people are entered as starting their career after 50 years old, including one after 60 years old.

The police officers working in the field enrolled thus earlier than their colleagues, and can later be promoted to higher positions.

```{r, warning=FALSE, message=FALSE, echo = FALSE, fig-3, fig.cap="Figure 3", out.width="80%", fig.asp=.75,fig.align='center'}
Employee_demographics %>%
  mutate(AGEBEGINNING = Age - `Service Years`) %>%
  arrange(desc(AGEBEGINNING)) %>%
  ggplot(aes(`Officer ED No.`, Age)) +
  geom_point(color = "lightgreen") +
  geom_point(aes(`Officer ED No.`, AGEBEGINNING), color = "red")
 
```

Considering now the gender among all categories of job classes, we  observe that the police officers are mostly male teams. Out of the four grades, there are only 4 women. Women occupy mostly administrative jobs, not linked to the process nor decision making about arrestation. In this way, we can keep in mind that our analysis would focus mainly on male officers.

```{r, warning=FALSE, message=FALSE, echo = FALSE, fig-4, fig.cap="Figure 4", out.width="80%", fig.asp=.75,fig.align='center'}
#Comupting the mean for the next plot
meanM<- Employee_demographics%>%
  group_by(Gender) %>%
  summarize(MEANSERVICE = mean(`Service Years`))

Employee_demographics %>%
  ggplot(aes(`Job Class Description`,`Service Years`)) + 
  geom_point(aes(color = Gender)) +
  geom_hline(yintercept = 14.24603, color = "darkblue") +
  geom_hline(yintercept = 12.02083, color = "pink") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size =6)) 
   labs(title = "Service length per position and gender",subtitle = "The average service is slighty longer for men,n/women have greater variance among year of service",caption = "Employee_demographics.csv", x= "Positions", y="Year of service")

```
We observe as well that our current focus includes exclusively white officers. It is an interesting point for further analysis. After simple computation, we knew that 24.1% of the CHPD were black and no black officers is present in our panel.

```{r, warning=FALSE, message=FALSE, echo = FALSE, fig-5, fig.cap="Figure 5", out.width="80%", fig.asp=.75,fig.align='center'}

#Computing the mean service length per race 
Employee_demographics %>%
    filter( `Job Class Description` == c("POLICE OFFICER I", "POLICE OFFICER II",  "POLICE OFFICER III","POLICE OFFICER IV", "POLICE SERGEANT", "POLICE CAPTAIN", "POLICE CHEF", "POLICE LIEUTENANT", "POLICE CHEF-ASSISTANT")) %>%
  ggplot(aes(Race, `Job Class Description` )) + 
  geom_point(color = "lightgreen") +
   geom_text(
    aes(label= Race, 
        hjust=2,
        vjust=2))
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size =6)) +
   labs(title = "Policemen are exclusively white",
        subtitle = "Race per job position", 
        caption = "Employee_demographics.csv", 
        x= "Race of the police officers", 
        y="Job Class")

```


We would like to know if there is a difference in process time for registering the complaint and the the arrestation process among race of victims. Even if there are some variations depending on the complexity of the case and the inherent time of investigation depending on the type of case, variation we cannot control, it would be interesting if there are anyway a global difference since our panel of 82'525 observations would somehow pool this variance.

Outliers are the typical cases showing this uncontrollable variation, we would neglect them and filter our dataset to observe only the delays inferior to 2000 days (more than 3 years). We observe that the time dedicated to investigation and arrestation for cases of white people is slightly higher than this time for black people. We would discard the assumption of a negligence in the treatment of cases related to black people.

```{r Incident reports}
Incident_reports%>%
  group_by(`Victim Race`)  %>%
  mutate(DELAYReported = `Date of Report`- `Date of Occurrence`, DELAYArrested = `Date Found`- `Date of Occurrence`) %>%
    filter(`Victim Race` == c( "B", "W" ) & DELAYArrested < 2000) %>%
  filter( DELAYArrested < 20000 & DELAYArrested > 100) %>%
  ggplot(aes( `Victim Race`, DELAYArrested )) +
  geom_boxplot() + 
   labs(title = "The time for arresting the sued party after a complaint is slightly higher for white victims",
        subtitle = "Delay of arrestation after a complaint per race of victim",
        caption = "Employee_demographics.csv", 
        x= "Race", 
        y="Delay between complaint and arrestation")
  
```



# By filtering de la sorte, we can see that there are more outliers for white people but and there is a greater variance in delay time for the arrestation when the case concern black people.

```{r Incident reports}
 Incident_reports %>%
   filter(`Date of Occurrence` > "2019-01-01") %>%
   group_by(`Date of Occurrence`) %>%
   count(`Date of Occurrence`) %>%
   ggplot(aes(`Date of Occurrence`, n)) +
   geom_histogram(stat= "identity")
     
   )
```
## Including Plots


```{r pressure, echo=FALSE}

Police_arrest_made %>%
  filter(`Weapon Present`== "UNARMED" & `Arrestee's Race` == c("B", "W")) %>%
  ggplot(aes(`Arrestee's Race`, `Arrestee's Age`)) +
  geom_boxplot(aes(color = `Arrestee's Race` ))

summary(Police_arrest_made)
meanAgeArrestee <- Police_arrest_made %>%
  group_by(`Arrestee's Race`)%>%
  summarize(MEDIANAGR = median(`Arrestee's Age`))
meanAgeArrestee
```
 
 The below table shows the number of arrestation by race and we note the equivalent proportion of black and white arestees. However, if we confront this information with the socio-demographic data of White Chapel in 2010, the black population represented only 9.9%. According to the data of Worldpopulationreview.com displaying the population of Chapel Hill and its population growth, the population growth between 2010 and 2018 was 6.24 %, so let's assume that the population of black people increased by the same percentage, and the variation would be +/- 6.24 [0% or 12.48%.] It would lead that in 2018, on year before our data, we should have 10.5% of black people in White Chapel Hill or a percentage included in [9.9% ; 11.17%]. Here, if we had to respect the proportion in the arrestee sample according to the white people number of arestee, should be around 386 black arestee, in order to be representative of the whole population. 3'651 black arrestees represent 945% of this extrapolation.
 
 https://worldpopulationreview.com/us-cities/chapel-hill-population/
 https://www.census.gov/quickfacts/fact/table/chapelhilltownnorthcarolina/POP060210
```{r pressure, echo=FALSE}

Police_arrest_made %>%
  filter(`Arrestee's Race` == c("W", "B")) %>%
  group_by(`Arrestee's Race`) %>%
  count() %>%
  arrange(desc(n)) %>%
    kable(caption= "Number of Arrestees per race", digits=2) %>%
  kable_styling(bootstrap_options = "striped")
```

 
 
 Later, we investigated the age of arrestee per race, in order to better know if a age trend exists. In order to do that, we plot the arrestee ages, separated in two groups: black and white arrestees and differenciated by gender.
 We note that the mean age of black arrestee (black line) in slightly superior to the white arestee mean age (orange line). The mean ages are respectedly 33 years for black people and 25 for white people. 
```{r pressure, echo=FALSE}

 Police_arrest_made %>%
   filter(`Arrestee's Race`== c("B", "W")) %>%
  ggplot(aes(`Arrestee's Race`, `Arrestee's Age` )) + 
  geom_boxplot(aes(color =  `Arrestee's Gender`)) +
  geom_hline(yintercept = 33, color = "black") +
  geom_hline(yintercept = 28, color = "bisque2") +
   labs(title = "Age of Arrestee per race",subtitle = "",caption = "Police_demographics.csv", x= "Race", y="Age of arrestee")
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

To refine the profiles of arestees with a view less sociio-demographics, we would like to know for what reason police officers proceeded to arrestation. Thus we confront the Type of arrest for 

```{r pressure, echo=FALSE}

 Police_arrest_made %>%
  filter(`Arrestee's Race`== c("B") %>%
  group_by(`Type of Arrest`,`Arrestee's Race`) %>%
  count(`Type of Arrest`) %>%
    arrange(desc(n)) %>%
  ggplot(aes(`Type of Arrest`, n)) +
  geom_bar(stat = "identity") 
```



```{r pressure, echo=FALSE}

 Police_arrest_made %>%
   filter(`Arrestee's Race`== c("B")) %>%
  group_by(`Type of Arrest`)%>%
  count(`Type of Arrest`) %>% 
  arrange(desc(n))  %>%
  ggplot(aes(`Type of Arrest`, n)) +
  geom_bar(stat = "identity") + 
   labs(title = "Only three motives for arrests concerning black people",
        subtitle = "Type of arrestations for black arrestees",
        caption = "Employee_demographics.csv", 
        x= "Type of arrest", 
        y=" Number of occurences")
```

```{r pressure, echo=FALSE}
subset <- Police_arrest_made %>%
  group_by(`Arrestee's Age`,`Arrestee's Gender`,`Arrestee's Race`, `Drugs or Alcohol Present`, `Weapon Present`, `Type of Arrest`) %>%
  filter(`Arrestee's Race`=="Black" | `Arrestee's Race` =="White") %>%
  filter(`Weapon Present`=="UNARMED" | `Weapon Present` =="ARMED") %>%
  filter(`Type of Arrest`=="SUMMONED/CITED" | `Type of Arrest` =="ON VIEW", `Type of Arrest` == "TAKEN INTO CUSTODY (WARRANT/LP)") %>%
  mutate(WhiteToBlack = ifelse(`Arrestee's Race`=="White", 0, ))

subset <- Police_arrest_made %>%
  mutate(WhiteToBlack = ifelse(`Arrestee's Race`=="White", 0, 100))


model <- glm(WhiteToBlack ~ `Arrestee's Age`+ `Arrestee's Gender`+`Drugs or Alcohol Present`+`Weapon Present`+`Type of Arrest`, data= subset)

xx <-broom::tidy(model)
broom::tidy(model) %>% 
  mutate(p.value = paste(round(p.value, 4), pval_star(p.value))) %>%
  select(-statistic) %>%
  kable( 
  caption = "Information about the estimate of the model", digits = 2
  ) %>% 
  kable_styling(
  bootstrap_options = "striped"
  )

```
