---
title: "Exploration analysis"
author: "Maeva Marin"
date: "19/04/2020"
output: html_document
---
```{r data, warning=FALSE, message=FALSE, echo = FALSE}
library(readr)

Traffic_stop<- read_delim("data/drivers-and-passengers-searched-by-sex-race-and-ethnicity.csv",";", escape_double = FALSE, trim_ws = TRUE)
Traffic_stop_2<-read_delim("data/initial-purpose-of-traffic-stop-by-drivers-sex-race-and-ethnicity.csv", ";", escape_double = FALSE, trim_ws = TRUE)
 
Police_arrest_made <- read_delim("data/police-arrests-made.csv",";", escape_double = FALSE, trim_ws = TRUE)
 
Employee_demographics<- read_delim("data/police-employee-demographics.csv",";", escape_double = FALSE, trim_ws = TRUE)

Incident_reports <-  read_delim("data/police-incident-reports-written.csv",";", escape_double = FALSE, trim_ws = TRUE)


```

```{r Employee Demographics}
library(tidyverse)
library(kableExtra)
# Employee Demographics
Employee_demographics %>%
  group_by(`Job Class Description`) %>%
  count(`Job Class Description`) %>% 
  arrange(desc(n)) %>%
  kable(caption= "Profession of the police officers by frequency", digits=2) %>%
  kable_styling(bootstrap_options = "striped")
```

We would like to know the proportion of the ethnicities among police officers. We have 128 white people (73.6%), three times less of black persons (24.1%) and 3 hispanic person (2.1%).

```{r}
Employee_demographics %>%
  group_by(Race) %>%
  count(Race) %>% 
  arrange(desc(n)) %>%
  kable(caption= "Proportion of the race in the CHPD", digits=2) %>%
  kable_styling(bootstrap_options = "striped")

```
We start to analyse the dataset of the police officers. This data base records sociodemographics information on the units of the CHPD, including their matriculation number, Job Class Description, Status, Age, Service Years, Gender and Race. We decided to focus on the job class what are in the field or in the hierarchy of those job classes, with regards to the aim of our project. We filtered thus Job Classes Despcription to obtain a subset including: "POLICE OFFICER I", "POLICE OFFICER II",  "POLICE OFFICER III","POLICE OFFICER IV", "POLICE SERGEANT", "POLICE CAPTAIN", "POLICE CHEF", "POLICE LIEUTENANT", "POLICE CHEF-ASSISTANT".

According to some studies run in the field, a chronic stress caused by police work is an explaination of the use of extralegal force (Griffin & Bernard, 2003). In order to set this assumption, we run two investigations: Figure 1 depicts the modes of the service lengths among genders. We observe that the service length is slightly longer for men than for women. The median ongoing career length for men is 15 years, whereas the women's is approximatively 6 years shorter (-40%). Even if newcomers lower the ongoing service length, such as the outlier in men's category, we observe that men are thus exposed on a longer period to a chronic stress, which is inherent to the job of police officer (Purba & Demou, 2019). 


Griffin, S., & Bernard, T. (2003). Angry Aggression Among Police Officers. Police Quarterly, 6(1), 3-21.
Purba, A., & Demou, E. (2019). The relationship between organisational stressors and mental wellbeing within police officers: a systematic review. BMC Public Health, 19(1).
Thomas, M., Kaufmann, C., Palmer, B., Depp, C., Martin, A., & Glorioso, D. et al. (2016). Paradoxical Trend for Improvement in Mental Health With Aging. The Journal Of Clinical Psychiatry, 77(08), e1019-e1025.
```{r, warning=FALSE, message=FALSE, echo = FALSE, fig-1, fig.cap="Figure 1", out.width="80%", fig.asp=.75,fig.align='center'}

library(dplyr)
meanM<- Employee_demographics%>%
   filter( `Job Class Description` == c("POLICE OFFICER I", "POLICE OFFICER II",  "POLICE OFFICER III","POLICE OFFICER IV", "POLICE SERGEANT", "POLICE CAPTAIN", "POLICE CHEF", "POLICE LIEUTENANT", "POLICE CHEF-ASSISTANT")) %>%
  group_by(Gender) %>%
  summarize(MEANSERVICE = mean(`Service Years`))

Employee_demographics %>%
   filter( `Job Class Description` == c("POLICE OFFICER I", "POLICE OFFICER II",  "POLICE OFFICER III","POLICE OFFICER IV", "POLICE SERGEANT", "POLICE CAPTAIN", "POLICE CHEF", "POLICE LIEUTENANT", "POLICE CHEF-ASSISTANT")) %>%
  group_by(Gender) %>%
  ggplot(aes(Gender,`Service Years`, color= Gender)) +
  geom_boxplot() +
labs(
    title = "Women's service is shorter than the men: men's career are almost quite the double",
    subtitle = "Glimpse of the service length in the Chapel Hill Police District among gender",
    x = "Police officers' gender",
    y = "Service length",
    caption = "data from Employee_demographics.csv",
    col = "Gender")
```

In order to contextualize this information, we had to know when those police officers started their career. We computed easily the age of enrollment, which  is the result of their age minus their service length. The age at which the officers began their career is an important important information, because the  young people are more mentally vulnerable than older ones (Thomas et al., 2016). Starting one's career at a young age and being exposed to a chronic stress and traumatic events have more impact on the subject due to one's age. 

Among filtered job categories, the starting age is under 30 years old in average. All officiers were thus early exposed to chronic stress, and more longer if they gained grades. The hierarchy cumulate more years of experience, between 16 years  old for the sergeant to 19 for the captain. It is intuitive because of the system of reward and the legitimization to obtain this position: the contrary would have been surprising.The hierarchy is not necessarily playing a direct role in the field. Yet, they give orders and guidelines to the police officers, installing a certain culture and mindset to the troops. 
Police officers' starting age takes part in the same interval than for their superior : between 25 and 30 years old. We have two police officers above this age, what could be explain by either a late career or a change in district. Howver, it seems that to reach the fourth level in police officer scale, the experience is a necessary element. Those policemens do not have less than 13 years old of experience, which is a large amount of time spent, by assumption, in streets and on missions.

For now, we have to ascertain if only those job classes follow the trend of young enrollment or if it is a general tendancy respected by all the human ressources of the CHPD.

```{r, warning=FALSE, message=FALSE, echo = FALSE, fig-2, fig.cap="Figure 2", out.width="80%", fig.asp=.75,fig.align='center'}

Employee_demographics %>%
  filter( `Job Class Description` == c("POLICE OFFICER I", "POLICE OFFICER II",  "POLICE OFFICER III","POLICE OFFICER IV", "POLICE SERGEANT", "POLICE CAPTAIN", "POLICE CHEF", "POLICE LIEUTENANT", "POLICE CHEF-ASSISTANT")) %>%
  mutate(AGEBEGINNING = Age - `Service Years`) %>%
  ggplot(aes( x = `Job Class Description`, 
              y = AGEBEGINNING,
              color = `Job Class Description`, 
              pch = `Job Class Description`,
              size = `Service Years`)) + 
  geom_text(
    aes(label= `Service Years`, 
        hjust=1,
        vjust=1)) +
  geom_point() +
labs(
    title = "Beyond the early age of enrollment among classes, we note that Police officer's \ngrade is based on service length",
    subtitle = "Age of enrollment and service length per job class in CHPD",
    x = "Job Class",
    y = "Age of enrollment",
    caption = "data from Employee_demographics.csv")
```

The distribution of the age of enrollement is less straightforward. Some employees start their career in their eraly 40's, a larger fraction after their 30's and 6 people are entered as starting their career after 50 years old, including one after 60 years old.

The police officers working in the field enrolled thus earlier than their colleagues, and can later be promoted to higher positions.

```{r, warning=FALSE, message=FALSE, echo = FALSE, fig-3, fig.cap="Figure 3", out.width="80%", fig.asp=.75,fig.align='center'}
Employee_demographics %>%
  mutate(AGEBEGINNING = Age - `Service Years`) %>%
  arrange(desc(AGEBEGINNING)) %>%
  ggplot(aes(`Officer ED No.`, Age)) +
  geom_point(color = "lightgreen") +
  geom_point(aes(`Officer ED No.`, AGEBEGINNING), color = "red")
 
```

Considering now the gender among all categories of job classes, we  observe that the police officers are mostly male teams. Out of the four grades, there are only 4 women. Women occupy mostly administrative jobs, not linked to the process nor decision making about arrestation. In this way, we can keep in mind that our analysis would focus mainly on male officers.

```{r, warning=FALSE, message=FALSE, echo = FALSE, fig-4, fig.cap="Figure 4", out.width="80%", fig.asp=.75,fig.align='center'}
#Comupting the mean for the next plot
meanM<- Employee_demographics%>%
  group_by(Gender) %>%
  summarize(MEANSERVICE = mean(`Service Years`))

Employee_demographics %>%
  ggplot(aes(`Job Class Description`,`Service Years`)) + 
  geom_point(aes(color = Gender)) +
  geom_hline(yintercept = 14.24603, color = "darkblue") +
  geom_hline(yintercept = 12.02083, color = "pink") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size =6)) 
   labs(title = "Service length per position and gender",subtitle = "The average service is slighty longer for men,n/women have greater variance among year of service",caption = "Employee_demographics.csv", x= "Positions", y="Year of service")

```
We observe as well that our current focus includes exclusively white officers. It is an interesting point for further analysis. After simple computation, we knew that 24.1% of the CHPD were black and no black officers is present in our panel.

```{r, warning=FALSE, message=FALSE, echo = FALSE, fig-5, fig.cap="Figure 5", out.width="80%", fig.asp=.75,fig.align='center'}
#Computing the mean service length per race 
Employee_demographics %>%
    filter( `Job Class Description` == c("POLICE OFFICER I", "POLICE OFFICER II",  "POLICE OFFICER III","POLICE OFFICER IV", "POLICE SERGEANT", "POLICE CAPTAIN", "POLICE CHEF", "POLICE LIEUTENANT")) %>%
  ggplot(aes(Race, `Job Class Description` )) + 
  geom_point(color = "lightgreen") +
   geom_text(
    aes(label= Race, 
        hjust=2,
        vjust=2))
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size =6)) +
   labs(title = "Policemen are exclusively white",
        subtitle = "Race per job position", 
        caption = "Employee_demographics.csv", 
        x= "Race of the police officers", 
        y="Job Class")

```


We would like to know if there is a difference in process time for registering the complaint and the the arrestation process among race of victims. Even if there are some variations depending on the complexity of the case and the inherent time of investigation depending on the type of case, variation we cannot control, it would be interesting if there are anyway a global difference since our panel of 82'525 observations would somehow pool this variance.

Outliers are the typical cases showing this uncontrollable variation, we would neglect them and filter our dataset to observe only the delays inferior to 2000 days (more than 3 years). We observe that the time dedicated to investigation and arrestation for cases of white people is slightly higher than this time for black people. We would discard the assumption of a negligence in the treatment of cases related to black people.

```{r Incident reports}
Incident_reports%>%
  group_by(`Victim Race`)  %>%
  mutate(DELAYReported = `Date of Report`- `Date of Occurrence`, DELAYArrested = `Date Found`- `Date of Occurrence`) %>%
    filter(`Victim Race` == c( "B", "W" ) & DELAYArrested < 2000) %>%
  filter( DELAYArrested < 20000 & DELAYArrested > 100) %>%
  ggplot(aes( `Victim Race`, DELAYArrested )) +
  geom_boxplot() + 
   labs(title = "The time for arresting the sued party after a complaint is slightly higher for white victims",
        subtitle = "Delay of arrestation after a complaint per race of victim",
        caption = "Employee_demographics.csv", 
        x= "Race", 
        y="Delay between complaint and arrestation")
  
```



# By filtering de la sorte, we can see that there are more outliers for white people but and there is a greater variance in delay time for the arrestation when the case concern black people.

```{r}
 Incident_reports %>%
   filter(`Date of Occurrence` > "2019-01-01") %>%
   group_by(`Date of Occurrence`) %>%
   count(`Date of Occurrence`) %>%
   ggplot(aes(`Date of Occurrence`, n)) +
   geom_histogram(stat= "identity")
     
   )
```
## Including Plots


```{r, echo=FALSE}

Police_arrest_made %>%
  filter(`Weapon Present`== "UNARMED" & `Arrestee's Race` == c("B", "W")) %>%
  ggplot(aes(`Arrestee's Race`, `Arrestee's Age`)) +
  geom_boxplot(aes(color = `Arrestee's Race` ))

summary(Police_arrest_made)
meanAgeArrestee <- Police_arrest_made %>%
  group_by(`Arrestee's Race`)%>%
  summarize(MEDIANAGR = median(`Arrestee's Age`))
meanAgeArrestee
```
 
 The below table shows the number of arrestation by race and we note the equivalent proportion of black and white arestees. However, if we confront this information with the socio-demographic data of White Chapel in 2010, the black population represented only 9.9%. According to the data of Worldpopulationreview.com displaying the population of Chapel Hill and its population growth, the population growth between 2010 and 2018 was 6.24 %, so let's assume that the population of black people increased by the same percentage, and the variation would be +/- 6.24 [0% or 12.48%.] It would lead that in 2018, on year before our data, we should have 10.5% of black people in White Chapel Hill or a percentage included in [9.9% ; 11.17%]. Here, if we had to respect the proportion in the arrestee sample according to the white people number of arestee, should be around 386 black arestee, in order to be representative of the whole population. 3'651 black arrestees represent 945% of this extrapolation.
 
 https://worldpopulationreview.com/us-cities/chapel-hill-population/
 https://www.census.gov/quickfacts/fact/table/chapelhilltownnorthcarolina/POP060210
```{r , echo=FALSE}

Police_arrest_made %>%
  filter(`Arrestee's Race` == c("W", "B")) %>%
  group_by(`Arrestee's Race`) %>%
  count() %>%
  arrange(desc(n)) %>%
    kable(caption= "Number of Arrestees per race", digits=2) %>%
  kable_styling(bootstrap_options = "striped")
```

Later, we investigated the age of arrestee per race, in order to better know if a age trend exists. In order to do that, we plot the arrestee ages, separated in two groups: black and white arrestees and differenciated by gender.
We note that the mean age of black arrestee (black line) in slightly superior to the white arestee mean age (orange line). The mean ages are respectedly 33 years for black people and 25 for white people. 
```{r , echo=FALSE}

 Police_arrest_made %>%
   filter(`Arrestee's Race`== c("B", "W")) %>%
  ggplot(aes(`Arrestee's Race`, `Arrestee's Age` )) + 
  geom_boxplot(aes(color =  `Arrestee's Gender`)) +
  geom_hline(yintercept = 33, color = "black") +
  geom_hline(yintercept = 28, color = "bisque2") +
   labs(title = "Age of Arrestee per race",subtitle = "",caption = "Police_demographics.csv", x= "Race", y="Age of arrestee")
```





```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(lubridate)
library(forcats)
```



After investigating on the proportion of behavioral causes of arrests, we decided again to differentiate black to white people. To do so, we chose an alternative method based on percentage: a ratio determining how many black citizens more were arrested for a certain motive of arrestto, scaled by the number of white arrestees, per year.

We note a clear overrepresentation of black citizens in this database. After sorting the ten first causes of arrests, black citizens accounted for the majority in 9 out of those 10 arrest causes (excepto for 2014, where black women appeared to be in majority in 8 out of 10 cases). Black people easily overcome the proportion of 20% additional arrestees with respect to the number of white arrestees. 

The most striking information is the ratio is the highest for investigation. In other words, for each 10 white citizen arrested for investigation, whatever the gender is, at least 16 black persons already have been arrested. Those 60% of difference between those two races clearly signifies a causal disproportion. However, narrowing down the specific cause of it is impossible and is not part of the present work. 

The reader has to keep in mind the black inhabitants' proportion in demographics dated 2010 in Chapel Hill (10%) and our extrapolation: (+/- 1.2%) per year, with respect to the whole population. The present arrestees sample is absolutely not representative of our population, even if estimated.

```{r}
##Analyze the highest purpose of the arrestation (between black and white people)
Traffic_stop_2 <- Traffic_stop_2 %>% mutate(Pro_Black_white = Black/White)
Traffic_stop_2$Pro_Black_white[is.nan(Traffic_stop_2$Pro_Black_white)]<-0
 
Traffic_stop_2 %>% group_by(Purpose, Gender) %>%
ggplot(aes(x= reorder(Purpose,Traffic_stop_2$Pro_Black_white) , y= Traffic_stop_2$Pro_Black_white)) +
  geom_bar(stat = "identity") +
  facet_grid(Gender~Year) +
  labs(title = "More black arrested for the investigation purpose" ,subtitle = "for the year 2014-2015", x= "Purpose", y= "Ratio Black/White")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
   scale_y_continuous(labels = scales::percent) +
  theme( strip.background  = element_blank(),
                      panel.grid.major = element_line(colour = "black"),
                      panel.border = element_blank(),
                      axis.ticks = element_blank(),
                      panel.grid.minor.x=element_blank(),
                      panel.grid.major.x=element_blank() )
```

We want to investigate if the previous proportion is verified in other datasets we have.
We would plot the number of arrestees per race as a time series. We keep other races (hispanic, Asian, Nativa American, Other and Unknown), for information.

We note that the proportion of white people is higher than the other races, except for black people. Since 2015, the trend is inverted and black people are sometimes more arrested than white people. Sometimes, the difference is shocking, for instance in March-April and July-August 2016 or June-July 2018. These differences are peaks that could be related to the meeting and strikes related to black shooting occuring in the year and to repeal a a law (HB2), as those articles relate:

https://unitedchurch.org/economic-social-justice-2/
https://www.newsobserver.com/news/local/community/chapel-hill-news/article68906692.html

We do neglect the possibility that mass movements could as well explain unusual peaks. However, as we mentioned earlier, the inverted trend is significantly verified in 2017, where white arrestees were a majority only during two first months. This fact could not be explained by mass movements.
```{r }
#Analzye the number of arrestation over the year in relation to the race.
library(lubridate)
Police_arrest_made<- Police_arrest_made %>% mutate(month=month(`Date of Arrest`), year= year(`Date of Arrest`))

Police_arrest_made <- Police_arrest_made%>% mutate(`Arrestee's Race` = fct_collapse(`Arrestee's Race`,
    "Asian"="A",
    "Black"="B",
    "Hispanic"="H",
    "Native American"="I",
    "Other" ="O",
    "Unknown"="U",
    "White"="W"))

graph1 = Police_arrest_made %>% count(`Arrestee's Race`, month, year) %>%
  filter(!is.na(`Arrestee's Race`))

ggplot(graph1,aes(x=month,y=n, fill= factor(`Arrestee's Race`), col= `Arrestee's Race`)) +
  geom_line() +
  facet_grid(~year)+
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  theme(legend.position ="bottom") +
  theme(legend.key.size = unit(0.5, "cm")) +
  scale_x_continuous( breaks = seq(1,12,by=5)) +
  labs(title = "Number of arrestation", subtitle = "year 2010 to 2019", x= "Date",y="Number of arrestation")

```

So as to support our previous observation, we run the same graph but highlight the difference between black and white races by the axis of absolute difference in grey. The identified trend is observed since 2015 on the absolute difference axis.
```{r }
## More focus on the ration of the black and white arrested 
##Same plot as before but only with the white and black people and plot the difference

graph2= Police_arrest_made %>% filter(`Arrestee's Race`=="White" | `Arrestee's Race` =="Black") %>% count(`Arrestee's Race`, month, year)

ggplot(graph2, aes(x=month,y=n)) +
  geom_line(size=1, aes(color=`Arrestee's Race`)) +
  geom_point(aes(color=`Arrestee's Race`)) +
  facet_grid(~year) +
  stat_summary(fun.y = diff, geom = "bar") +
  theme(legend.position ="bottom")  +
  scale_x_continuous( breaks = seq(1,12,by=5))
```
Investigating the arrestees gender, we observed that the number of men is in average 3 times the number of arrested women, both races combined. The male arrestees number remains above the 600 for white and for black (except in 2012, around 580) from 2010 to 2015. Until that date, Black arrestees' number belongs to an approximate interval of [580;800], with a high increase between 2012-2015 (approx. +35%). White arrestees belongs to the interval [600:800]. Both races decreases tremendously afterwards, but the black community always remains higher of +50 numbers of arrestees in average, which denotes well the disparity among races.

In 2015, some institutional policy must have been applied to decrease the number of arrestee preventively or punishingly because the number of arrestees has decreased for both white and black citizens. The trend of a decrease in the number of arrestees is observed one year later for women: in 2016. Women arrestees number is quite stable, oscillating in an interval of [100;200] for white women and [50;150]

```{r }
##Number of arrestation taking into account the race and the gender

graph4 <- Police_arrest_made %>% count(`Arrestee's Race`, `Arrestee's Gender`, year) %>%
  filter(!is.na(`Arrestee's Race`))

ggplot(graph4,aes(x=year,y=n, fill= factor(`Arrestee's Race`), col= `Arrestee's Race`)) +
  geom_line() +
  facet_grid(~`Arrestee's Gender`)+
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  theme(legend.position ="bottom") +
  theme(legend.key.size = unit(0.5, "cm"))  +
  labs(title = "Number of arrestation", subtitle = "year 2010 to 2019", x= "Date",y="Number of arrestation") +
  scale_x_continuous( breaks = seq(2010,2019,by=1))

```

The age would complete the profile of our arrestees, all gender combined. White arrestees are slightly younger (27-28 yo)  considering the median than black people (34-35yo), Even the 1rst and 3rd modes are present a difference of about 5 years, making black arestees older.
```{r }
## Arrestation Age by ethnicity
Police_arrest_made %>%
  filter(`Arrestee's Race`== c("Black", "White")) %>%
  ggplot(aes(`Arrestee's Race`, `Arrestee's Age` )) +
  geom_boxplot() +
  labs(x= "Arrestee's Race", y= "Age",
       title = "Age corresponding to each Ethnicity",
       subtitle = "Arrested pepople between 2010 and 2019")
```
 We would now consider the type of arrestation among black and white arrestees, the other races being displayed for information only. 
 Black arestees have more chance to be taken into custody than white people (until 2 times, in 2011). The difference in proportion of race pu into cuatody remains quite stable, each year verifying the schocking gap between white and black arrestees taken into custody.
 
Since 2012, the black proportion of peolple summoned or cited increased  to reach 300 arrestees per year, in 2015 and 2016. The curve for white arrestees depicts a yearly decrease in the number of white arrestees, starting in 2010 with a number higher than 400, reaching a flat stage for about 3 years (2012-2015) and the decreased has accelerated since this moment. However, we not that in this category as well, the curves of respectively black and white people arrested has become mixed for the past 5 years, making this sample as well not representative for the entire population. 

The same comment could be made for arrestees on view, with a tinier gap between white and black people, but always at the cost of black persons.
```{r }
##Analyze the type of arrestation taking into account the race

graph5 = Police_arrest_made %>% count(`Arrestee's Race`, `Type of Arrest`, year) %>%
  filter(!is.na(`Type of Arrest`))

ggplot(graph5,aes(x=year,y=n, fill= factor(`Arrestee's Race`), col= `Arrestee's Race`)) +
  geom_line() +
  facet_grid(~`Type of Arrest`)+
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  theme(legend.position ="bottom") +
  theme(legend.key.size = unit(0.5, "cm"))  +
  labs(title = "Different pattern for each type of arrestation", subtitle = "year 2010 to 2019", x= "Date",y="Number of arrestation") +
  scale_x_continuous( breaks = seq(2010,2019,by=1))

```

```{r }
Traffic_stop<- read_delim("data/drivers-and-passengers-searched-by-sex-race-and-ethnicity.csv",";", escape_double = FALSE, trim_ws = TRUE)

 Traffic_stop_2<-read_delim("data/initial-purpose-of-traffic-stop-by-drivers-sex-race-and-ethnicity.csv", ";", escape_double = FALSE, trim_ws = TRUE)
 
Police_arrest_made <- read_delim("data/police-arrests-made.csv",";", escape_double = FALSE, trim_ws = TRUE)
 
Employee_demographics<- read_delim("data/police-employee-demographics.csv",";", escape_double = FALSE, trim_ws = TRUE)

Incident_reports <-  read_delim("data/police-incident-reports-written.csv",";", escape_double = FALSE, trim_ws = TRUE)
```

In order to better understand the dataset of car arrestation, we want to know what type of arrest prevails per year.

The strict majority among categories is speed limit violation, which overpass 4'000 arrestations per year, in both 2014 and 2015, and whose gender proportion approximate a 55%-45%. Speed violation is a daily risk for drivers, whether it is done voluntary or not and for this reason speed violation was an easy bet as the first cause of verbalization. 

The second and third causes of arrest concerned violation of vehicle regulations or equipment regulations. Which is interesting to note here is that the first causes of arrests, whose number of occurences exploded in 2014 and 2015, concerns a behavioral cause. Other behavioral causes are fewly reported: (safe or other) movement violations, driving whiled impaired, etc. Offensive or violent behaviors are not significantly represented here other than potentially trhough speed violation which, as we previously said, could be unwanted.
```{r cars}
##Traffic stop
##Analyze the highest porpose of the arrestation ( between female and male)

Traffic_stop_2<-Traffic_stop_2 %>% filter(Purpose != "Total" & Purpose != "FemaleTotal" & Purpose != "MaleTotal")

Plot1 <- ggplot(Traffic_stop_2, 
                aes(x=Purpose,
                    y= Traffic_stop_2$`Total By Ethnicity`, 
                    fill= Gender)) +
  geom_bar(stat = "identity") +
  facet_wrap(~Year) +
  labs(title = "The main purpose is the speed limit violation" ,subtitle = "for the year 2014-2015", x= "Purpose", y= "Total stop by race")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
Plot1
```

## Incident reports

```{r }

Incident_reports<- Incident_reports%>% mutate(`Victim Race` = fct_collapse(`Victim Race`,
    "Asian"="A",
    "Black"="B",
    "Hispanic"="H",
    "Native American"="I",
    "Other" ="O",
    "Unknown"="U",
    "White"="W"))

Incident_reports<- Incident_reports %>% mutate(month=month(`Date of Occurrence`), year= year(`Date of Occurrence`))

graph6 = Incident_reports %>%filter(year>=2010) %>% count(`Victim Race`, `Victim Gender` , year) %>% filter(`Victim Gender`=="F" | `Victim Gender`=="M")

ggplot(graph6,aes(x=year,y=n, fill= factor(`Victim Race`), col= `Victim Race`)) +
  geom_line() +
  facet_grid(~`Victim Gender`)+
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  theme(legend.position ="bottom") +
  theme(legend.key.size = unit(0.5, "cm"))  +
  labs(title = "White people are the Major victim ", subtitle = "year 2010 to 2019", x= "Date",y="Number of Victim") 
```


```{r }
library(broom)

```


```{r}
## Create the training/test set
library(randomForest)
library(tidyverse)
library(janitor)

PAM <- Police_arrest_made %>%
  clean_names() %>%
  filter(arrestees_race == c("Black","White")) %>%
  mutate(arrestees_race =if_else(arrestees_race == "Black", "Black", "White", missing = NA_character_) %>% factor()) %>%
  na.omit() %>% 
  select(arrestees_race, arrestees_age, type_of_arrest, drugs_or_alcohol_present, weapon_present) %>%
  mutate_if(is.character, as.factor)
  
set.seed(123)
# index.tr <- c(sample(1:50, replace=FALSE, size=35),50+sample(1:50, replace=FALSE, size=35),100+sample(1:50, replace=FALSE, size=35))
# arrest.tr <- PAM[index.tr,]
# arrest.te <- PAM[-index.tr,]
mod.rf <- randomForest(formula = arrestees_race ~ arrestees_age + type_of_arrest + drugs_or_alcohol_present + weapon_present,
                       data = PAM)

pred.te <- predict(mod.rf, newdata=arrest.te, type="class")
confusionMatrix(data=pred.te, reference = arrest.te$`Arrestee's Race`)
```

